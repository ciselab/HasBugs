FROM haskell:8.8.4-stretch

WORKDIR /build
COPY . .

RUN echo "deb http://archive.debian.org/debian stretch main contrib non-free" > /etc/apt/sources.list
RUN apt-get update
RUN apt-get -y install software-properties-common
RUN add-apt-repository ppa:ondrej/php
RUN apt-get install -y libpcre3 libpcre3-dev

RUN cabal update
RUN cabal configure --enable-tests
RUN cabal install --only-dependencies 
RUN cabal build

ENTRYPOINT ["cabal","test"]